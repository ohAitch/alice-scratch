#!/usr/bin/env ζ
arg ← {ι: process.argv[2]}

diy_stdin ← λ(f){ process.stdin.setRawMode(true); process.stdin.resume().setEncoding("utf8").on("data",λ(key){ f(key) === -1 && process.stdin.pause() }) }

gen ← λ(ι){name←;
	t ← multiline(λ(){/*
		// ==UserScript==
		// @name        NAME
		REST
		// @require     FILE
		// @grant       none
		// ==/UserScript==
		*/})
		.replace('NAME',name=require('path').basename(ι,'.js'))
		.replace('REST',φ(ι).text.match(/^(?:\/\/ (?:@r|@m).*\n)+/)[0].trim())
		.replace('FILE',φ(ι).url)
	p(t); shᵥ`bash -ci 'sfx ack'`; osaᵥ`chrome: open location ${'chrome-extension://dhdgffkkebhmkfjojejmpbldmpobfkfo/options.html'}; activate`

	// user_js ← '/tmp/userscript_'+10..map(ι => rand(/[0-9a-z]/.genex_0())).join('')+'.user.js'
	// φ(user_js).set(t)
	// t ← ()=> osaᵥ`chrome: open location ${φ(user_js).url}`
	// ↩ [name, t]
	}
	
if (arg.ι) gen(arg.ι)//[1]()
// else {
// 	ιs ← φ`./*.js`.φs.map(gen)
// 	process.stdout.write('press any key to install\n')
// 	t ← λ*(){for(;;){
// 		if (!ιs.length) ↩ -1
// 		ι ← ιs.shift()
// 		process.stdout.write('  '+ι[0]+'\n'); yield
// 		ι[1]()
// 		}}(); t.next()
// 	diy_stdin(λ(key){↩ key==='\x03'? -1 : t.next().value})
// 	}
