if( location.host==='venmo.com' ) throw Error('ignore me') # this was breaking venmo

############################# builtins & copying Œ∂ #############################
E ‚Üê {}
_ ‚Üê require('lodash')
$ ‚Üê require('jquery')
def ‚Üê (o,name,Œπ)=>{
	if (Tfun(Œπ)) Œπ = lazy(name,Œπ)
	'configurable' in Œπ || (Œπ.configurable = ‚úì)
	'value' in Œπ?
		'writable' in Œπ || (Œπ.writable = ‚úì) :
		'set' in Œπ || (Œπ.set = Œª(Œπ){ def(@,name,{value:Œπ, enumerable:‚úì}) })
	Object.defineProperty(o,name,Œπ); ‚Ü© o }
Tfun ‚Üê E.Tfun = Œπ=> typeof Œπ === 'function'
Function.prototype.every = Œª(Œπ){‚Ü© setInterval(@,max(0,Œπ)*1e3) }
Function.prototype.every_leading = Œª(Œπ){ setTimeout(@,0) ;‚Ü© @.every(Œπ) }
max ‚Üê Math.max; min ‚Üê Math.min

#################################### prelude ###################################
has_prop ‚Üê (o,m)=> Object.getOwnPropertyDescriptor(o,m) !== ‚àÖ

css ‚Üê Œπ=>{ t ‚Üê document.createElement('style'); t.innerHTML = Œπ; document.head.appendChild(t) }
mk_script ‚Üê Œπ=>{ t ‚Üê document.createElement('script'); Object.assign(t,Œπ); document.getElementsByTagName('head')[0].appendChild(t) }

# util_inspect_autodepth(    at_url\('.*?'\)    .map(Œπ=> [Œπ,RegExp('^'+Œπ.replace(/\./g,'\\.').replace(/\*/g,'.*')+'$')])._.object()) shit i broke this
at_urls ‚Üê { ,'*github.com':/^.*github\.com$/ ,'*githubusercontent.com':/^.*githubusercontent\.com$/ ,'imgur.com':/^imgur\.com$/ ,'*stackexchange.com':/^.*stackexchange\.com$/ ,'*stackoverflow.com':/^.*stackoverflow\.com$/ ,'*serverfault.com':/^.*serverfault\.com$/ ,'*superuser.com':/^.*superuser\.com$/ ,'*.askubuntu.com':/^.*\.askubuntu\.com$/ ,'stackexchange.com':/^stackexchange\.com$/ ,'math.stackexchange.com':/^math\.stackexchange\.com$/ ,'stats.stackexchange.com':/^stats\.stackexchange\.com$/ ,'ux.stackexchange.com':/^ux\.stackexchange\.com$/ ,'*asoftmurmur.com':/^.*asoftmurmur\.com$/ ,'*wordpress.com':/^.*wordpress\.com$/ ,'hangouts.google.com':/^hangouts\.google\.com$/ ,'*google.com':/^.*google\.com$/ ,'*discordapp.com':/^.*discordapp\.com$/ ,'gzgreg.github.io':/^gzgreg\.github\.io$/ }
at_url ‚Üê Œπ=> location.hostname.match(at_urls[Œπ])

on_seen_Œî ‚Üê f=> document.addEventListener('visibilitychange',=> f(!document.hidden))
on_seen_Œî_leading ‚Üê f=>{ setTimeout(=>f(‚úì),0) ;on_seen_Œî(f) }
on_seen_Œî_leading_every ‚Üê f=>{ var êÖ´êÖ¨êÖÉêÖ¨êÖ∞ ;on_seen_Œî_leading(seen=> seen? êÖ´êÖ¨êÖÉêÖ¨êÖ∞ = f() : clearInterval(êÖ´êÖ¨êÖÉêÖ¨êÖ∞) ) }

################################################################################
get_viaudeo ‚Üê =>{
	vs ‚Üê document.getElementsByTagName('video'); as ‚Üê document.getElementsByTagName('audio')
	if (vs.length + as.length === 0) console.warn('no (vi|au)dios')
	if (!(vs.length === 1 || (vs.length === 0 && as.length === 1))) console.warn('too many (vi|au)dios: '+vs.length+', '+as.length)
	‚Ü© vs[0] || as[0] }
has_prop(window,'rate') || def(window,'rate',{ get(){‚Ü© get_viaudeo().playbackRate }, set(Œπ){ get_viaudeo().playbackRate = Œπ }, })
# rate_el ‚Üê =>{
# 	vs ‚Üê $`video`; as ‚Üê $`audio`; bs ‚Üê [‚Ä¶vs,‚Ä¶as]
# 	if bs ‚âà []: warn('no (vi|au)dios')
# 	(vs‚âà[*]  |  vs‚âà[] & as‚âà[*]) | warn('too many (vi|au)dios: '+vs.L+', '+as.L)
# 	‚Ü© bs[0].prop`playbackRate` }
# def(window,'rate') || def(window,'rate', => rate_el().Œπ, Œπ isa 0 => rate_el().Œπ = Œπ)

when_at ‚Üê [ ,'scholtek.com','xkcd.com','egscomics.com','strongfemaleprotagonist.com','smbc-comics.com','kongregate.com','gunnerkrigg.com','konggames.com' ]
host2 ‚Üê location.host.split('.').slice(-2).join('.')
if( when_at.some(Œπ=> host2===Œπ) )
	css('* { image-rendering:pixelated; }')

has_prop(window,'my') ||( window.my = =>{
	window.global ||( window.global = window )
	global.jQuery ||( global.$ = $ )
	global._ ||( global._ = _ )
	})

################################################################################
if( ['*github.com','*githubusercontent.com'].some(at_url) )
	css('pre, .tab-size { tab-size:2 !important; }')

if( at_url('imgur.com') ){
	$('#imagelist').parent().remove()
	$('.sentence-sorting').remove()	
	}

if( ['*stackexchange.com','*stackoverflow.com','*serverfault.com','*superuser.com','*.askubuntu.com'].some(at_url) ){
	$('#hot-network-questions li > a:not([href^="http://math."]):not([href^="http://ux."])').closest('li').remove()
	$('#hot-network-questions li').removeClass('dno').removeClass('js-hidden')
	$('#hot-network-questions > a').remove()

	$('.ad-container').remove()
	$('#newsletter-ad').parent().remove()

	if( at_url('stackexchange.com') )
		$('#question-list > :not([data-sid^="math."]):not([data-sid^="ux."])').remove()
	else if( !at_url('math.stackexchange.com') && !at_url('ux.stackexchange.com') ){
		if (location.pathname in {'/':0, '/questions':0, '/unanswered':0})
			$('#mainbar').remove()
		else if( !at_url('stats.stackexchange.com') )
			{ $('#sidebar > .sidebar-linked').remove(); $('#sidebar > .sidebar-related').remove() }
		}
	}

if( at_url('*asoftmurmur.com') ){
	$('#site-title, #gp-container, #about-link-container').remove()
	$('#intro-text').text('')
	$('#intro-text').css('height','1px')
	$('#pb').css('margin','50px auto 0px auto')
	}

# if( location.href.match(/^https:\/\/calendar\.google\.com\/calendar\/render.*$/) ){
# 	t ‚Üê document.getElementById('onegoogbar')
# 	while (t.firstChild) t.removeChild(t.firstChild)
# 	t.style.height = '30px'
# 	t.style.background_color = '#f1f1f1'
# 	}

if( at_url('*wordpress.com') ){
	$('#wpadminbar').remove()
	}

if( at_url('hangouts.google.com') ){
	f ‚Üê =>{ $('.g-Ue-v0h5Oe, .g-Qx-eb, .g-Qx-F').remove() }; f(); f.every(0.5)
	}

if( at_url('*google.com') ){
	$in ‚Üê $('input[title="Search"]')
	if( $('#searchform').length && $in.length ){
		# todo: the svg thing should extend off the left side farther than it does
		$('body').append($('<svg style=";z-index:5000 ;position:absolute ;top:74px ;width:9px ;height:30px"><polygon points="0,0 0,9 9,9"></polygon><polygon points="0,9 9,9 9,21 0,21"></polygon><polygon points="0,30 0,21 9,21"></polygon></svg>'))
		update ‚Üê Œπ=>{
			t ‚Üê Œπ
				.replace(/\B‚ààse\b/i,'(site:stackexchange.com OR site:mathoverflow.net OR site:serverfault.com OR site:superuser.com)')
				.replace(/\B‚ààyc\b/i,'site:news.ycombinator.com')
				.replace(/\B‚ààgit\b/i,'site:github.com')
				# .replace(/\B‚àà/i,'site:')
				.replace(/((?!-).)\bdl\b/i,'$1'+'-inurl:htm -inurl:html intitle:‚Äùindex of‚Äù')
			t===Œπ || $in.val(t).submit() }
		input ‚Üê ''; (=>{t‚Üê; input === (t=$in.val()) || update(input = t)}).every(0.05)
		}
	}

if( at_url('*discordapp.com') ){
	# https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver
	on_seen_Œî_leading_every(=> (=>{
		location.pathname.match(/^\/channels\/@me\//) &&
			$('.user-name').map(Œª(){ $(@).text().match(/^[‚Ä°‚óç]$/) ||( $(@).text()==='alice'? $(@).text('‚Ä°').css({ backgroundColor:'#005322' ,color:'#1f8b4c' ,borderRadius:'4px' }) : $(@).text('‚óç').css({ backgroundColor:'#806028' ,color:'#bda06d' ,borderRadius:'4px' }) ) })
		}).every_leading(100))
	# on_seen_Œî_leading_every(=> (=>{
	# 	# only act when the user is not typing?
	# 	Œπ ‚Üê $($('textarea').toArray().filter(x=> ($(x).attr('class')||'').includes('textAreaEnabled'))[0])
	# 	a ‚Üê Œπ.val()
	# 	b ‚Üê a.replace(/(.)ck|(?!lmk)(.)(?! k )(.)k(?=(?!n).)/g,'$1$2$3êëí')
	# 	# b ‚Üê a.replace(/z/g,'êëü')
	# 	a===b || Œπ.val(b)
	# 	}).every_leading(1))
	}

# @match       *://books.google.com/*

# var my_encode = .replace(/[^A-Za-z0-9 ]/g,'_')
# var pad0 = Œπ=> ('0000'+Œπ).slice(-4)
# var dict_or = (Œπ,k)=> (k in Œπ? Œπ[k] : k)

# var persist_o = name=> {
# 	localStorage.getItem(name) === null && localStorage.setItem(name,'{}')
# 	var o = JSON.parse(localStorage.getItem(name))
# 	return function(k,Œπ){return arguments.length === 1? o[k] : (o[k] = Œπ, localStorage.setItem(name, JSON.stringify(o)), Œπ)} }
# var img_to_data = Œπ=> {
# 	var t = document.createElement('canvas')
# 	t.width = Œπ.width; t.height = Œπ.height
# 	t.getContext('2d').drawImage(Œπ,0,0)
# 	return t.toDataURL('image/png').replace(/^data:image\/(png|jpg);base64,/,'') }
# var dl_data = (Œπ,name)=> {
# 	var t = document.createElement('a')
# 	t.href = 'data:application/octet-stream,'+Œπ
# 	t.target = '_blank'
# 	t.download = name
# 	t.click()
# 	}

# localStorage.removeItem('book_dl__dl_cache')
# var dl_cache = persist_o('book_dl__dl_cache')

# setTimeout(=>{

# var title = $('.gb-volume-title').text().trim() || location.href
# setInterval(catch_(=>{
# 	$('.pageImageDisplay img').toArray().map(Œπ=> {
# 		Œπ.complete || return_()
# 		var h = $(Œπ).attr('src') || return_()
# 		h === '/googlebooks/restricted_logo.gif' && return_()
# 		var t = h.match(/pg=([A-Z]{2})(\d+)/);
# 		var pg = t? dict_or({'PA':'','PP':'.f','PR':'.p'},t[1])+pad0(t[2]) : my_encode(h)
# 		var t = my_encode(title)+' - '+pg+'.png.64'; dl_cache(t) || (dl_cache(t,1), dl_data(img_to_data(Œπ), t))
# 		})
# 	}), 0.05*1e3)

# },1*1e3)

#################################### .bashrc ###################################
# dl_fix(){ f ~/Downloads; f ~/pg; Œ∂ '
# 	fs ‚Üê require("fs")
# 	from ‚Üê process.env.HOME+"/Downloads"
# 	out ‚Üê process.env.HOME+"/pg"
# 	fix ‚Üê Œπ=> Œπ
# 		.replace(/^Impro_ Improvisation and the Theatre -/,"Impro -")
# 	fs.readdirSync(from).filter(.re`\.64$`).map(Œª(Œπ){fs.writeFileSync(out+"/"+fix(Œπ).replace(/\.64$/,""), Buffer.from(fs.readFileSync(from+"/"+Œπ)+"","base64")); fs.unlinkSync(from+"/"+Œπ)})
# 	;'; }


# @match       *://*.facebook.com/*
# @require jquery

# window.$ = $

# if ($('#pagelet_timeline_medley_friends').length) {

# var load_friends = cb=> {(function load_friends(){
# 	if( $('.FriendButton').length < ($('[data-tab-key="friends"] ._gs6').text()|0) ){
# 		window.scrollBy(0,1e9)
# 		var t = $('.FriendButton').length; (function Œõ(){if ($('.FriendButton').length !== t) load_friends(); else setTimeout(Œõ,0.01*1e3)})()
# 		} else cb&&cb() })() }

# $('body').append('<button id="load_friends" style="z-index:1000; position:fixed; top:3px; left:22px;">load all</button>')
# $('body').append('<button id="compact" style="z-index:1000; position:fixed; top:23px; left:13px;">compactify</button>')
# $('#load_friends').click(load_friends)
# $('#compact').click( =>{
# 	$('#pagelet_sidebar, #pagelet_dock').remove()
# 	load_friends( =>{
# 		$('u:contains("Acquaintance")').closest('li').remove()

# 		$('#pagelet_timeline_medley_friends ~').remove()
# 		$('#pagelet_timeline_medley_friends').css('width','1425px').css('margin-left','-120px')
# 		$('#pagelet_timeline_medley_friends li').css('width','176px')
# 		$('.FriendButton').parent().parent().parent().remove()
		
# 		var t = $('.uiList[data-pnref="friends"]'); t.toArray().slice(1).map(Œπ=> $(Œπ).find('>').toArray().map(Œπ=> $(Œπ).detach().appendTo(t.eq(0))))

# 		window.scrollBy(0,-1e9)
# 		}) })

# }


# @match       *://*.facebook.com/*
# @require jquery

# if (!location.pathname.match(/^\/messages\//)){

# # t ‚Üê '323232c0'.match(/../g).map(Œπ=>parseInt(Œπ,16)); 'rgba('+[‚Ä¶t.slice(0,3),t[3]/255].join(',')+')'
# text = `
# ‚Åò music is important, see if you can divert some
# facebook time into music sorting time

# ‚Ä° i notice that music sorting feels like
# {i Shouldnt be doing this, its a waste of time}
# and facebook feels like
# {i am making solid connection to the social}
# `
# $('body').append(`<div style='z-index:1000; position:fixed; display:flex; justify-content:center; align-items:center; top:20%; bottom:20%; left:20%; right:20%;  background-color:rgba(50,50,50,0.7529411764705882); color:#d5d5cf; font-family:"Avenir Next"; font-size:28px; border-radius:15px;'>${text.trim().replace(/\n/g,'<br>')}</div>`)

# }


# @match       http*://*.soundcloud.com/*
# @require jquery

# var t = setInterval(function(){
# 	if (!$('.heroPlayButton-pause').length && $('.playControl.playing').length) {$('.playControl').click(); clearInterval(t)}
# 	}, 0.1*1e3)
