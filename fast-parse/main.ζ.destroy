// ------------------------------- fast_parse ------------------------------- //
make_line_col_index â† (in_,i)=>{ lines â† in_.slice(0,i).split('\n'); â†© { offset:i, line:lines.length, column:lines[-1].length+1, } }

word_extra â† re`â™ˆ-â™“ğŸ”…ğŸ”†`; word_extra_gu â† re`[${word_extra}]`.g
word â† re`A-Za-z0-9_$Ê°-Ê¸Ë¡-Ë£Î‘-Î¡Î£-Ï‰á´¬-áµ›áµ¢-áµ¥á¶œá¶ á¶»â°â±â¿â‚-â‚“â‚•-â‚œâ„‚â„•â„šâ„â„¤â±¼â±½${word_extra}`
ident â† re`(?![0-9])[${word}]+|@`
comment â† re`(?://.*|/\*[^]*?(?:\*/|$))+`
simple_js â† P(()=> P.alt([
	P(comment).R`#comment`,
	[ P('{'), simple_js, P('}') ],
	[ P.alt([
		P(/(['"])((\\.|(?!\1|\\)[^])*?\1)/).map(Î¹=> Î¹[0]).R`#string`,
		ident,
		P([ P('`').R`#template`, tmpl_Î¹.*, P('`').R`#template` ]),
		/[)\]0-9]/,
		]), P(re`[ \t]*(?!${comment})/`).?.map(Î¹=> Î¹||'') ],
	P(re`/(?:(?:[^/\\\[]|(?:\\.)|\[(?:[^\\\]]|(?:\\.))*\])*)/(?:[a-z]*)`).R`#regex`,
	re`[^{}/'"â€¦${'`'})@\]${word}]+|[^}]`,
	]).* )
tmpl_Î¹ â† P.alt([ [ P('${').R`#template`, simple_js, P('}').R`#template` ], P(/(?:\\[^]|(?!`|\$\{)[^])+/).R`#template` ])
js_file â† P([ P(/(?:#!.*\n)?/).R`#shebang`, simple_js ])

Î¶_parse â† code=>{ r â† []; for(var t of parse(js_file.skip(/$/),code)._.flatten()) Tstr(t) && Tstr(r[-1])?( r[-1]+=t ): r.push(t); â†© r }
test â† ()=> Î¶_parse(in_); in_ â† Ï†`/tmp/foo`.text // Ï†`~/code/scratch/Î¶/index.Î¶`.text
// pass â† JSON.stringify(test())===Ï†`/tmp/aaaa`.text
// cn.log(pass?'pass âœ“':'fail X')
cn.log(js_file)
// cn.log('perf',bench(test,{TH:3}))
cn.log('perf',pretty_time_num(bench1(test) * (Ï†`~/code/scratch/Î¶/index.Î¶`.text.length / Ï†`/tmp/foo`.text.length)))
// cn.log('output',test())
