############################ operations on git repos ###########################
################# merge ################
to_path=~/code/scratch
from='lang-alpha'
from_url='git@github.com:alice0meta/lang-alpha.git'

cd "$to_path"
git remote add "$from" "$from_url"
git fetch "$from"
git merge "$from/master"
git remote remove "$from"

################# split ################
split(){ repo=~/code/scratch ;subfolder='.archive' ;out=~/code/.archive ;tmp_branch=kc8vu2z3a
	# !!! this will destroy existing commit ids ;use carefully
	# may not work with unicode filenames
	# may not work at all

	cd "$repo"
	git subtree split -P "$subfolder" -b "$tmp_branch"

	mkdir -p "$out" ;cd "$out"
	git init
	git pull "$repo" "$tmp_branch"

	cd "$repo"
	git filter-branch --index-filter "git rm -q -r -f --cached --ignore-unmatch ABC" --prune-empty HEAD
	git branch -D "$tmp_branch"

	# cleanup?
	rm -rf .git/refs/original/
	git reflog expire --all
	git gc --aggressive --prune=now
	git reflog expire --all --expire-unreachable=0
	git repack -A -d
	git prune

	git push --force origin
	}

############################## this is pretty cute #############################
# ! color names randomly in ansi 12359abc
gen2fn ‚Üê f=>{ t ‚Üê f() ;‚Ü© => t.next().value }
# gen2fn ‚Üê f=> [#Q seq(f()).next_Œπ #Q].bind
namegen ‚Üê gen2fn(Œª*(){
	long ‚Üê 'bekas cahlo caris cekla dedna dekik emiak eseik gazok gihza girim gumlu halbo hanka henuh kadut kagzi kakki kamor kehul kisar kizak kofur kohig lopra mesat mesip mezid motka nahso nalic nirsu omiac radil ratis repgi resra rukan siral sorzo tarak tilke zalsi zehaz zekhu zeluz zephu zifin zirez zohip zokmi zonri zusci'.split(' ')
	short ‚Üê 'ake bek cah cek dek din emi esi faz gaz gih gir gum hal han kad kag kam keh ket kis kiz kob koh kot lop mez mot nal nir oki omi rad rar sar tar tus zal zar zeh zek zel zep zif zok zon zus'.split(' ')
	short = short.map‚Ä¶(Œπ=> 10..map(i=> Œπ+' '+i))._.shuffle()
	to ‚Üê round((long.‚Äñ)/2) ;yield* _.shuffle([‚Ä¶long, ‚Ä¶short.slice(0,to)]) ;yield* short.slice(to)
	c ‚Üê {} ;for(;;){ t ‚Üê '#'+4..map(Œπ=> üé≤([‚Ä¶/[0-9a-z]/])).join('') ;if (c[t]) continue ;yield (c[t]=1, t) } })

###################################### ocr #####################################
# # used up: alice0meta@gmail.com
# # 46 requests remaining on sparkleshy@gmail.com @ KqsDmZ77kW
# # 100 requests remaining on comely.naiad@gmail.com @ rtjM58zxK2
# ocr() { curl -X POST http://api.ocrapiservice.com/1.0/rest/ocr -F 'apikey=rtjM58zxK2' -F 'language=en' -F "image=@$1" > "${1%.*}.txt" ;}
tesseract ‚Üê npm`node-tesseract@0.2.7`
œÜ`../ep/*`.map(f=>{ tesseract.process(sh`${f}`,(e,Œπ)=>{ fs(f+'.txt').$ = e? 'ERROR\n'+e : Œπ }) })

################################ jquery ish misc ###############################
E.poll = Œª(f,cb,time){ r‚Üê{} ;(Œª Œõ(){ nxt ‚Üê => nxt=0 ;t ‚Üê f(nxt) ;r.done = !!t ;t? cb.P(‚àÖ,t).defer() : nxt? Œõ.in(time) : Œõ.defer() })() ;‚Ü© r }

keyinfo ‚Üê Œª(key){
	t ‚Üê {'‚á•':[9,'‚Üì'],'‚Ü©':[13],'‚éã':[27,'‚Üë'],'‚Üê':[37,'‚Üì'],'‚Üë':[38,'‚Üì'],'‚Üí':[39,'‚Üì'],'‚Üì':[40,'‚Üì']}[key]||[]
	‚Ü© {code: t[0] || ord(key), $onfn: t[1]? {'‚Üë':'keyup','‚Üì':'keydown'}[t[1]] : 'keypress'} }
$.prototype.on_key = Œª(key,sel,cb0){ if( arguments.length===2 ){ [key,cb0,sel] = arguments }
	# [key,‚Ä¶ns] ‚Üê key.split(/(?=\.\w)/) ;ns = ns.join('')
	t ‚Üê keyinfo(key) ;@.on(t.$onfn/*+ns*/,sel,Œª(e){if (e.which===t.code) ‚Ü© cb0(e)}) }
$.prototype.find_self = Œª(sel){‚Ü© @.find(sel).add(@.filter(sel))}

################################ de-duplication ################################
œÜ`**`.œÜs.map(Œπ=> [Œπ+'',Œπ.get()])._.groupBy(1)|>(_.values).map(Œπ=> _(Œπ).map(0)).filter(.‚Äñ > 1)

############################## python data science #############################
import matplotlib.pyplot as plt
import matplotlib.image as mpimg
import numpy as np
from mpl_toolkits.mplot3d import Axes3D

q = mpimg.imread('/Users/home/Downloads/a.png')
fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')
x = q[:,:,0].ravel()
y = q[:,:,1].ravel()
z = q[:,:,2].ravel()
ax.scatter(x, y, z)
ax.set_xlabel('R Label')
ax.set_ylabel('G Label')
ax.set_zlabel('B Label')
plt.show()

############################## sublime api things ##############################
T ‚Üê 10 ;i‚Üê0 ;(=>{sb_edit·µ•(sb.tab.active)`view.insert(edit,view.sel()[0].begin(),"\n")`}).every(T)

##################################### life #####################################
sublime_set_buffer ‚Üê Œπ=> sb_edit·µ•(sb.tab.active)`view.replace(edit,Region(0,view.size()),${Œπ})`

braille_table ‚Üê 0x100.map(Œπ=> chr(ord(' ')+Œπ))
braille_2d ‚Üê Œª(Œπ){‚Ü© (T.Buffer(Œπ.Œπ)? Œπ.Œπ.chunk(Œπ.X) : Œπ).chunk(4).map(Œª(Œπ){t ‚Üê [] ;for(i‚Üê0;i<Œπ[0].‚Äñ;i+=2) t.push(braille_table[(Œπ[0][i]<<0)|(Œπ[1][i]<<1)|(Œπ[2][i]<<2)|(Œπ[0][i+1]<<3)|(Œπ[1][i+1]<<4)|(Œπ[2][i+1]<<5)|(Œπ[3][i]<<6)|(Œπ[3][i+1]<<7)]) ;‚Ü© t.join('')}).join('\n')}
life ‚Üê Œª(Œπ){
	if (!Œπ) {Œπ ‚Üê {X:115*2,Y:46*4} ;Œπ.Œπ = Buffer.from((Œπ.X*Œπ.Y).map(=> üé≤()<0.5 ?1:0 )) ;‚Ü© Œπ} # 115,46
	else {X ‚Üê +Œπ.X ;Y ‚Üê +Œπ.Y ;Œπ = Œπ.Œπ
		r ‚Üê Buffer.from(Œπ)
		get ‚Üê (x,y)=> 0<=x&&x<X && 0<=y&&y<Y? Œπ[y*X+x] : 0
		for(y‚Üê1;y<Y-1;y++) for(x‚Üê1;x<X-1;x++) {
			n ‚Üê Œπ[(y-1)*X+x-1] + Œπ[(y-1)*X+x] + Œπ[(y-1)*X+x+1] + Œπ[y*X+x-1] + Œπ[y*X+x+1] + Œπ[(y+1)*X+x-1] + Œπ[(y+1)*X+x] + Œπ[(y+1)*X+x+1]
			r[y*X+x] = (n===2? Œπ[y*X+x] : n===3? 1 : 0) }
		for(y‚Üê0;y<Y;y+=Y-1) for(x‚Üê0;x<X;x++) {
			n ‚Üê 0 ;for(x‚Çí‚Üê-1;x‚Çí<=1;x‚Çí++) for(y‚Çí‚Üê-1;y‚Çí<=1;y‚Çí++) n += get(x+x‚Çí,y+y‚Çí)
			r[y*X+x] = (n===2? get(x,y) : n===3? 1 : 0) }
		for(x‚Üê0;x<X;x+=X-1) for(y‚Üê1;y<Y-1;y++) {
			n ‚Üê 0 ;for(x‚Çí‚Üê-1;x‚Çí<=1;x‚Çí++) for(y‚Çí‚Üê-1;y‚Çí<=1;y‚Çí++) n += get(x+x‚Çí,y+y‚Çí)
			r[y*X+x] = (n===2? get(x,y) : n===3? 1 : 0) }
		# for(y‚Üê0;y<Y;y++) for(x‚Üê0;x<X;x++) {
		# 	n ‚Üê 0 ;for(y‚Çí‚Üê-1;y‚Çí<=1;y‚Çí++) for(x‚Çí‚Üê-1;x‚Çí<=1;x‚Çí++) n += get(x+x‚Çí,y+y‚Çí)
		# 	r[y*X+x] = (n===3? 1 : n===4 && get(x,y)===1? 1 : 0) }
		‚Ü© {X,Y,Œπ:r} } }
Œπ‚Üê ;for(;;) sublime_set_buffer(braille_2d(Œπ = life(Œπ)))

########################## bits. floating point bits. ##########################
bit_reverse = Œª(L,Œπ){r ‚Üê 0 ;for (i‚Üê0;i<L;i++){r = (r << 1) | (Œπ & 1) ;Œπ = Œπ >> 1} ;‚Ü© r}
to_binary_LE ‚Üê Œπ=> [‚Ä¶Œπ].map(Œπ=> ('00000000'+Œπ.toString(2)).slice(-8).split('').reverse().join('')).join('')
q ‚Üê Œπ=>{ t ‚Üê Buffer(8) ;t.writeDoubleLE(Œπ,0) ;t = to_binary_LE(t) ;‚Ü© t.slice(0,52)+' '+t.slice(52,52+11)+' '+t[-1]+' = '+Œπ }

################################### entities ###################################
entities_encode ‚Üê .replace(/[&"'<>]/g,Œª(Œπ){‚Ü© {'&':'&amp;', '"':'&quot;', '\'':'&apos;', '<':'&lt;', '>':'&gt;'}[Œπ]})
entities_decode ‚Üê typeof(window)==='undefined'? npm`html-entities@1.2.0`.AllHtmlEntities.decode : Œª(Œπ){t ‚Üê document.createElement('textarea') ;t.innerHTML = Œπ ;‚Ü© t.value}

######################## fun with fraction approximation #######################
wu ‚Üê npm`wu@2.1.0`
Array.prototype.maplog = Œª(f){‚Ü© @.map((Œπ,i,l)=>( i%(l. length / 100 |0)===0 && log(Time(),'mapping @',i,'/',l.‚Äñ), f(Œπ,i,l) )) }
gcd ‚Üê (a,b)=> b>0? gcd(b, a%b) : a
reduced ‚Üê (a,b)=>{ t ‚Üê gcd(a,b) ;‚Ü© [a/t,b/t] }
bits ‚Üê Œπ=> log2(Œπ[0]*Œπ[1])
list_approx ‚Üê Œª*(Œπ){ Rp ‚Üê (a,b)=> gcd(a,b)===1 ;a‚Üê1 ;b‚Üê1 ;for(;;){
	while (a/b > Œπ) b++ ;if (Rp(a,b-1)) yield [a,b-1] ;if (Rp(a,b)) yield [a,b]
	while (a/b < Œπ) a++ ;if (Rp(a-1,b)) yield [a-1,b] ;if (Rp(a,b)) yield [a,b]
	} }
error ‚Üê (Œπ,approx)=>{ t ‚Üê (approx[0]/approx[1]) / (Œπ[0]/Œπ[1]) ;‚Ü© 1 - (t<1? t : 1/t) }
score ‚Üê (Œπ,approx)=> ((Œπ[0]*Œπ[1]) / (approx[0]*approx[1])) * (1/error(Œπ,approx))
best_approx ‚Üê x=>{ size_x ‚Üê x[0]*x[1] ;‚Ü© [‚Ä¶wu(list_approx(x[0]/x[1])).takeWhile(Œπ=> Œπ[0]*Œπ[1] < size_x)]._.max(Œπ=> score(x,Œπ)) }

to ‚Üê 1e5
‚ßó(=> log(
	(to/2).map(Œπ=> reduced(Œπ, to)).filter(Œπ=> log2(to)*2*0.6 <= bits(Œπ) && bits(Œπ) <= log2(to)*2).maplog(Œπ=> [Œπ, best_approx(Œπ)] ).filter(Œπ=> 1 < Œπ[1][0] && Œπ[1][1] > 9)._.sortBy(Œπ=> score(Œπ[0],Œπ[1])).slice(-40).map(Œπ=> (Œπ[0][0]/Œπ[0][1])+' ‚âà '+Œπ[1][0]+'√∑'+Œπ[1][1]).join('\n')
	) )

############################### neat chrome apis ###############################
http://developer.chrome.com/extensions/accessibilityFeatures
http://developer.chrome.com/extensions/debugger
http://developer.chrome.com/extensions/devtools_inspectedWindow
http://developer.chrome.com/extensions/devtools_network
http://developer.chrome.com/extensions/downloads
http://developer.chrome.com/extensions/extension
http://developer.chrome.com/extensions/tabs
http://developer.chrome.com/extensions/windows

############################## data : friend glue ##############################
google_youtube ‚Üê npm`googleapis@18.0.0`.youtube('v3')
google_depaginate ‚Üê (f,opt)=> Œ†(yes=>{ r ‚Üê [] ;q ‚Üê Œπ=>{ r.push(‚Ä¶Œπ.items) ;if( r.‚Äñ < Œπ.pageInfo.totalResults ) (=> f({ pageToken:Œπ.nextPageToken } ‚Ä¶‚Üê (opt)).then(q) ).in(0.1) ;else yes(r) } ;f(opt).then(q) })
yt_auth ‚Üê œÜ`~/.auth/_`.json['google.youtube']
youtube ‚Üê {
	video:{ from:({id,part='contentDetails,id,liveStreamingDetails,localizations,recordingDetails,snippet,statistics,status,topicDetails'})=>
		?Œ†?(google_youtube.videos.list)({ ,auth:yt_auth ,part ,id }).then(.items[0] )
		},
	playlist:{ from:({id,part='contentDetails,id,snippet,status'})=>
		google_depaginate( ?Œ†?(google_youtube.playlistItems.list),{ auth:yt_auth, part, playlistId:id, } )
		},
	}

# rwby_dl(){ /usr/local/bin/youtube-dl -o ~/file/consume/video/RWBY/"$2.%(ext)s" "$1" ;}
# rwby_dl W9wyWgvyp0s 's3e01 Round One'

rwby_episodes ‚Üê youtube.playlist.from({ id:'PLUBVPK8x-XMhCW2fW7ZYlD9MHjvmT8IGK' }).then( .map(Œπ=> youtube.video.from({ id:Œπ.snippet.resourceId.videoId }).then(Œπ=>{ if (!Œπ) ‚Ü© ‚àÖ ;t ‚Üê Œπ.snippet.title.match(/^RWBY (?:Volume (\d+), )?Chapter (\d+): (.+)$/) ;‚Ü© { id:Œπ.id, name: !t? Œπ.snippet.title : 's'+(t[1]||'1')+'e'+('00'+t[2]).slice(-2)+' '+t[3] } }) ) |>(Promise.all) )

rHjUHnG7WOQ should be obviously type(youtube url)
youtube.video.from({ id:'rHjUHnG7WOQ' })

################################################################################
global key command: chrome bookmarks?
really why dont you have sublime s command autocomplete yet
[ ‚Ä¶fi`/Applications/Sublime Text.app/Contents/MacOS/Packages/Default.sublime-package/Default.sublime-commands`.Œπ, ‚Ä¶œÜ`~/Library/Application Support/Sublime Text 3/Packages/User/Default.sublime-commands`.json ]

def(E,'fi',=>{
	# do the right thing by hardcoding it for each input you want to give it :/ hm
	Œª fi(ss,‚Ä¶Œπs){
		is_template([ss,‚Ä¶Œπs]) || ‚ÄΩ
		Œπ ‚Üê '/Applications/Sublime Text.app/Contents/MacOS/Packages/Default.sublime-package/Default.sublime-commands'
		‚âà( ss.raw, [Œπ] ) || ‚ÄΩ
		zip ‚Üê '/Applications/Sublime Text.app/Contents/MacOS/Packages/Default.sublime-package'
		sub ‚Üê 'Default.sublime-commands'
		get ‚Üê =>{
			sh·µ•`rm -rf /tmp/mbq3p ;mkdir /tmp/mbq3p ;unzip ${zip} -d /tmp/mbq3p/Default`
			t ‚Üê œÜ`/tmp/mbq3p/Default/${sub}`.text
			# this json needs lenient parsing (sigh)
			t = t.replace(/,(?=\s*\])/g,'')
			‚Ü© JSON.parse(t) }
		‚Ü© [#Q {}.Œπ #Q].def({ get /*,set(Œπ){ ‚ÄΩ }*/ }).o
		}
	‚Ü© fi })

E.lenient_json_parse = (=>{
	P ‚Üê require('./parsimmon2.js')

	whitespace ‚Üê P(/\s*/m)
	escapes ‚Üê { ,b:'\b' ,f:'\f' ,n:'\n' ,r:'\r' ,t:'\t' }
	un_escape ‚Üê (str)=> str.replace(/\\(u[0-9a-fA-F]{4}|[^u])/ ,(À£,escape)=> escape[0]==='u'? chr(parseInt(escape.slice(1),16)) : escapes[escape[0]] || escape[0] )
	comma_sep ‚Üê (parser)=> P.sepBy(parser ,token(P(',')))
	token ‚Üê p=> p.skip(whitespace)

	l_null ‚Üê token(P('null')).map(=> null)
	l_t ‚Üê token(P('true')).map(=> ‚úì)
	l_f ‚Üê token(P('false')).map(=> ‚úó)
	l_str ‚Üê token(P(/"((?:\\.|.)*?)"/ ,1)).map(un_escape).desc('string')
	l_num ‚Üê token(P(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/)).map(Number).desc('number')

	json ‚Üê P.lazy(=> whitespace.then(P.alt( object ,array ,l_str ,l_num ,l_null ,l_t ,l_f )) )
	array ‚Üê token(P('[')).then(comma_sep(json)).skip(token(P(']')))
	pair ‚Üê P.seq(l_str.skip(token(P(':'))) ,json)
	object ‚Üê token(P('{')).then(comma_sep(pair)).skip(token(P('}'))).map(Œπ=> _u.object(Œπ))
	‚Ü© Œπ=> json.parse(Œπ).value })()

################################################################################
# duti -s com.google.Chrome chrome-extension

##################################### tests ####################################
/ 'charCodeAt|fromCharCode|codePointAt|fromCodePoint' # should be ord,chr

#################### IccXML install instructions : osx 10.12 ###################
brew install libtiff
brew install pkg-config
brew install libxml2
‚Ä° delete most of extract_probe_data.cpp
./configure --with-tifflib=/usr/local/Cellar/libtiff/4.0.7_3
make
make install
cd IccXML-0.9.8
PKG_CONFIG_PATH=/usr/local/opt/libxml2/lib/pkgconfig
./configure
make
make install
# multiply vcgt by x^(Œ≥/1.6) , use iccFromXml iccToXml

########################## i dont know what this does ##########################
;[process.stdout, process.stderr].forEach(s=> s && s.isTTY && s._handle && s._handle.setBlocking && s._handle.setBlocking(‚úì) ) # sad fix

######################## global-invariant type detection #######################
E.__global = (=>{
	anon_e4jlu ‚Üê Œπ=> catch_Œπ(=> Œπ.toString.constructor('return this')() )
	id ‚Üê Symbol.for`‚£±‚£õ‚†É‚£ò‚£æ‚£∏‚¢é‚†™‚°©‚†ô`
	‚Ü© Œπ=>{t‚Üê;G‚Üê ;if( Tprim(Œπ) ) ‚Ü© ;if(t= Œπ[id] ) ‚Ü© t ;if(!(G= anon_e4jlu(Œπ) )) ‚Ü© ;G.Object.prototype‚Äò[id] .host= { ,value:G ,configurable:‚úó } ;‚Ü© Œπ[id] } })()
Tarr_1 ‚Üê Œπ=>{ t ‚Üê __global(Œπ) ;‚Ü© t && Œπ instanceof t.Array }
Œπ=> __global(Œπ) && Œπ instanceof __global(Œπ)[T]     super mega slow
Œπ=> Œπ instanceof Array                             faster or on par with builtin
Œπ=> Œπ instanceof global.Array                      very slow??

#################################### scruff ####################################
'Function.prototype.at':lazy('at',=>{priorityqueuejs ‚Üê npm`priorityqueuejs@1.0.0`
	# https://github.com/Automattic/kue
	# https://github.com/rschmukler/agenda
	# robust to setTimeout taking extra time
	# ! not robust to the process failing ! should use redis or something instead !
	# ! wth is up with the { hrtime() ‚Ä¶‚Üê> time } comparison
	qu ‚Üê new priorityqueuejs((a,b)=> b.time-a.time)
	P‚Üê ;ensure ‚Üê =>{if (P) ‚Ü© ;P = ‚úì ;(Œª Œõ(){t‚Üê;
		qu.size() === 0? (P = ‚úó) : qu.peek().time < hrtime()? (t=qu.deq(), t.Œπ&&t.Œπ.in(), Œõ()/*nxt*/) : Œõ.in(0.1)/*poll*/
		})() }
	‚Ü© Œª(time){ t ‚Üê {time, Œπ:@} ;‚Ü© time < hrtime()? (t.Œπ.in(), =>{}) : (qu.enq(t), ensure(), =>{t.Œπ = ‚àÖ}) } }),
# del(){ for v in "$@" ;do v="$(realpath "$v")" ;Œ∂ 'osa·µ•`finder: delete POSIX file ${Œπ}`;' "$v" ;rm -f "$(dirname "$v")/.DS_STORE" ;done ;}
im_pdf_to_png__bad() { for v in "$@" ;do convert -verbose -density 150 -trim "$v" -quality 100 -sharpen 0x1.0 png:"${v%.*}.png" ;done ;}
convert -verbose -density 150 -trim 'from.pdf' -quality 100 -flatten -sharpen 0x1.0 x.jpg
ff_crop(){ ffmpeg -i file:"$1" -ss "$2" -t "$3" -async 1 file:"${1%.*} cut".mp4 ;}
E.googl = Œπ=> JSON.parse(sh·µ•`curl -s ${'https://www.googleapis.com/urlshortener/v1/url?key='+œÜ`~/.auth/googl`.text.trim()} -H 'Content-Type: application/json' -d ${JSON.stringify({longUrl:Œπ})}`+'').id

######### remaining work for œÜ #########
formats include
	image               
	pixels              
	png                 .png
	jpg                 .jpg
	plist               /^<\?xml / && /<\/plist>\s*$/           read: npm::plist.parse(it)     show: npm::plist.build(it)
	xml                 .xml || /^<\?xml /
	base64              .64
	pixels (grey)       
	stdin               fd:0
	FIFO                fd:0...
	:executable         ,/^#!/ | try{node.fs.accessSync(Œπ,node.fs.X_OK) ;‚Ü© ‚úì} catch(e){‚Ü© ‚úó}
	directory relative
	directory absolute
formats are Really stream formats
the formats are complicated to interact with, because
* GET POST PUT have really tangly apis for all sorts of efficiency concerns
* DELETE especially, we want to make some distinctions to make sure we don‚Äôt fuck things up accidentally (although trash could help)

# paths can have extensions, which are often meaningful. (basename/filename, ext/suffix. path.basename,dirname,extname)

# we need to be careful with non-atomic transactions
# we need to think about how this interacts with concurrency
# we need to think about how this interacts with distributed machines (e.g. mixing file and http URLs)
# 	‚Äúlike, it should be caching urls all the time.‚Äù

############################ which ports are in use ############################
sudo lsof -PiTCP -sTCP:LISTEN

########################### todo - this is an odd log ##########################
Œπ ‚Üê 'N3wyOHwxOTR8MHwwfDM4fDE5LjkxNjQ2NTgyNjE4OTQ3M3wwfDB8MnwwfDExMDl8MTQwfDB8M3wwfDF8OHwxfDB8MXwxfDF8MjI4fHRydWV8ZmFsc2V8dHJ1ZXwxNTEwOTcyMTc1NDkyfDB8MHx0cnVlfHRydWV8dHJ1ZXwxLDAsMCwwLDAsMCwwLDAsNSwxMCwxMCwyMCwyMCwxMSwxNiwyMCwxLDAsMCwwLDAsMSwwLDMsNiw1LDUsNSw1LDUsNSwxMHwtMSwtMSwtMSwtMSwtMSwtMSwtMSwtMQ==|YzI4NzJmYTg4MTZlY2IzNzhhNDU0MzI1ZmJjMjExMzc='
Œπ.split('|')[0] |>(Œπ=> Buffer.from(Œπ,'base64')+'')
r ‚Üê '7|28|10000|0|0|38|19.916465826189473|0|0|2|0|1109|140|0|3|0|1|8|1|0|1|1|1|228|true|false|true|1510972175492|0|0|true|true|true|1,0,0,0,0,0,0,0,5,10,10,20,20,11,16,20,1,0,0,0,0,1,0,3,6,5,5,5,5,5,5,10|-1,-1,-1,-1,-1,-1,-1,-1'
node.crypto.createHash('md5').update(r).digest().toString('hex')
b ‚Üê '4866525ce4fc2a3331806600943bb995'
;[r,b].map(Œπ=> Buffer.from(Œπ).toString('base64')).join('|')

################################## friend glue #################################
E.chrome_simple_osa·µ• = (Œπ,{tab,window=0})=> osa·µ•`chrome: execute window ‚Ä¶${window+1}'s tab ‚Ä¶${tab+1} javascript ${Œ∂_compile(Œπ)}`
E.chrome_simple_js_·µ• = (Œπ,{tab,window=0})=> osa·µ•`chrome: tell window ‚Ä¶${window+1}'s tab ‚Ä¶${tab+1} to set URL to ${'javascript:'+Œ∂_compile(Œπ)}`
# E.chrome·µ• = ‚Ä° not actually used ‚Ä° wait, nope, is actually used, but mostly in one-off scripts
	# Œª(Œπ,tab){tab = tab!==‚àÖ? 'tab '+(tab+1) : 'active tab'
	# 	# E.chrome_$·µ• = Œª(Œπ,tab){r‚Üê; $null ‚Üê '__$null_'+üé≤id.greek(10) ;fst ‚Üê 1 ;while ((r=chrome·µ•("if( window.jQuery){"+Œπ+"} else {"+(fst? (fst=0 ,"t ‚Üê document.createElement('script') ;t.src = 'https://code.jquery.com/jquery-3.1.1.min.js' ;document.getElementsByTagName('head')[0].appendChild(t)") : "")+"; '"+$null+"'}",tab))===$null) ;‚Ü© r}
	# # probably add a üé≤id.greek(10) call to '#applescript_hack'
	# 	t ‚Üê "t ‚Üê document.querySelectorAll('#applescript_hack')[0] ;t && t.parentNode.removeChild(t) ;Œπ ‚Üê (0,eval)("+JSON.stringify(Œ∂_compile(Œπ))+") ;t ‚Üê document.createElement('div') ;t.id = 'applescript_hack' ;t.style = 'display:none;' ;t.textContent = JSON.stringify(Œπ) ;t2 ‚Üê document.querySelectorAll('head')[0] ;t2.insertBefore(t,t2.firstChild) ;‚àÖ"
	# 	chrome_simple_js_·µ•(t,tab)
	# 	t ‚Üê "document.querySelectorAll('#applescript_hack')[0].textContent"
	# 	‚Ü© JSON.parse(chrome_simple_osa·µ•(t,tab) || '""') }

########################################
open_photoshop(){ open -a '/Applications/Adobe Photoshop CC 2015.5/Adobe Photoshop CC 2015.5.app' "$@"; }

####################### misc little-used .bashrc material ######################
im_size(){ for v in "$@" ;do [ -f "$v" ] && { identify -format "%f %wx%h" "$v" ;echo ;} ;done ;}
im_to_png(){ for v in "$@" ;do [[ $v = *.png ]] || { convert "$v" png:"${v%.*}.png" && rm "$v" ;} ;done ;}
im_to_jpg(){ for v in "$@" ;do [[ $v = *.jpg ]] || { convert "$v" jpg:"${v%.*}.jpg" && rm "$v" ;} ;done ;}
# im_to_png(){ Œ∂ ' a.map(Œπ=> Œπ.re`\.png$` || sh·µ•`convert ${Œπ} png:${Œπ minus extension}.png && rm ${Œπ}`) ;' "$@" ;}
im_to_grey(){ for v in "$@" ;do convert "$v" -colorspace gray "$v" ;done ;}
im_concat(){
	local tile=$(Œ∂ '!!Œπ.re`^(\d+x\d*|x\d+)$`' "$1" && { echo "$1" ;shift ;} || echo x1)
	local out="${@: -1}" ;if ! [ -e "$out" ] ;then set -- "${@:1:$(($#-1))}" ;else while [ -e "$out" ] ;do out="${out%.*}~.${out##*.}" ;done ;fi
	montage -mode concatenate -tile "$tile" "$@" "$out" ;}
im_rotate_jpg(){ jpegtran -rotate 90 -outfile "$1" "$1" ;}
ff_to_audio(){ ffmpeg -i file:"$1" -vn file:"${1%.*}".mp3 ;}
# ff_ogg_to_mp3(){ ffmpeg -i "$1" -codec:v copy -codec:a libmp3lame -q:a 2 ../q/"${1%.ogg}.mp3" ;}
im_autowhite(){ ~/code/scratch/im_autowhite "$@" ;}

comic_rotate(){
	mkdir '#rotated' ;for v in * ;do [[ $v = '#rotated' ]] || cp -r "$v" '#rotated' ;done
	cd '#rotated' ;find . -type f -print0 | while IFS= read -r -d $'\0' t ;do convert -rotate 270 "$t" "$t" ;done ;}
cp_devi(){ rsync --protect-args --partial --progress --rsh=ssh 'alice@devi.xyz:/home/alice/'"$1" "$2" ;}
ls_devi(){ ssh alice@devi.xyz 'find . -not -path "*/\\.*" -type f' | sort ;}
nom=user@74.207.242.236
nom(){ ssh "$nom" ;}

‚ß´. pb ==>{
	_pastebin_id ‚Üê =>
		process.stdin.pin().then(Œπ=>{
			t‚Üê sh·µ•`curl -s 'http://pastebin.com/api/api_post.php' -d 'api_option=paste&api_paste_private=1&'${œÜ`~/.auth/pastebin`.text.replace(/\n$/,'')} --data-urlencode api_paste_code=${Œπ}`
			‚Ü© (t+'').replace(/.*\//,'') })
	‚Ü© (=> _pastebin_id().then(Œπ=>{ go_to('http://pastebin.com/raw/'+Œπ) ;Œπ = 'http://alice.sh/txt#'+Œπ ;p(Œπ) ;log('copied:',Œπ) }) )
		‚Ä¶‚Üê({ cant_pool:‚úì }) }

################################################################################
E.pixels = {
	read: Œª(Œπ,type='rgb',cb){npm('get-pixels@3.2.3')(œÜ(Œπ)+'',Œª(e,{data:D,shape:[X,Y,depth],stride}){X|=0;Y|=0
		// maybe just use Symbol.iterator ?
		;(depth === 4 && stride._.isEqual([4,X*4,1])) || (Œª(){throw Error()})()
		if      (type==='rgba') Œπ ‚Üê D
		else if (type==='rgb' ) {Œπ ‚Üê Buffer(X*Y*3); pÀ°‚Üê0; p·µà‚Üê0; for(i‚Üê0;i<X*Y;i++) {Œπ[pÀ°++]=D[p·µà++]; Œπ[pÀ°++]=D[p·µà++]; Œπ[pÀ°++]=D[p·µà++]; p·µà++}}
		else if (type==='grey') {Œπ ‚Üê Buffer(X*Y); for(i‚Üê0;i<X*Y;i++) Œπ[i] = D[i*4]}
		else throw Error()
		cb(e,{X,Y,Œπ}) }) },
	show: Œª({Œπ,X,Y},type='rgb',to){
		t ‚Üê new (npm('pngjs@2.2.0').PNG)({width:X, height:Y}); D ‚Üê t.data; p‚Üê0
		if      (type==='rgba') (T.Buffer(Œπ)? Œπ : Buffer(Œπ)).copy(t.data)
		else if (type==='rgb' ) for(i‚Üê0;i<Œπ.length;) {D[p++] = Œπ[i++]; D[p++] = Œπ[i++]; D[p++] = Œπ[i++]; D[p++] = 0xff}
		else if (type==='grey') for(i‚Üê0;i<Œπ.length;) {D[p++] =         D[p++] =         D[p++] = Œπ[i++]; D[p++] = 0xff}
		else throw Error()
		t.pack().pipe(fs.createWriteStream(œÜ(to)+'')) },
	}

################################################################################
Œπ ‚Üê [
	,['eng0',bits(Buffer.from(wikipedia_source('English_language')))]
	,‚Ä¶ 0x100.map(Œπ=> xor_repeat(b8(Œπ),Ox`1b37373331363f78151b7f2b783431333d78397828372d363c78373e783a393b3736`)|>(x=>[ ,'‚äï'+Œπ.toString(16).padStart(2,'0')+':'+see_buffer(x) ,bits(x) ]) )
	]
	.map(([name,Œπ])=>[ ,name
	,Œπ.chunk(êÖØêÖ´êÖ¨êÖú).map(Œπ=> parseInt(Œπ.reverse().join(''),2) )
		|>(find_mostlikely_frequencies_assuming_Œπ_has_fixed_frequencies_over_Œ±Œ≤)
	])

electron_window('Œ∂see',Œπ,Œπ=>{ eval_main(.focus())

# Œπ=Œπ .map(.map(Œπ=>{ êÖ™ ‚Üê Math.log2 ;t ‚Üê 2^-7 ;‚Ü© (êÖ™(t+Œπ)-êÖ™(t))/(êÖ™(t+1)-êÖ™(t)) }))
t ‚Üê Œπ.map(..1)
t ‚Üê new (npm`ml-pca@2.1.0`)(t,{center:‚úì}).predict(t)
t = numeric2.norm01(t.‚Ä¶).chunk(t[0].‚Äñ)
Œπ = _.zip(Œπ.map(..0),t)

t ‚Üê Œπ.find(..0==='eng0')[1] ;Œπ=Œπ ._.sortBy(Œπ=> numeric2.L2(t,Œπ[1]))

require_new`/~/code/scratch/see.Œ∂`._0n_0n_01_labeled(Œπ)

});

################################################################################
open ‚Üê Œª(Œπ,ifdne,f){
	ensure_exists(Œπ,ifdne) ;Lc ‚Üê new Œ¶(Œπ).‚Äñ
	fd ‚Üê fs.openSync(Œπ,'r+') ;f({
		,get L(){‚Ü© Lc}
		,read(i,L){t ‚Üê Buffer.allocUnsafe(L) ;fs.readSync(fd,t,0,L,i) === L || ‚ÄΩ ;‚Ü© t}
		,write(Œπ,i){L ‚Üê fs.writeSync(fd,Œπ,i) ;Lc = max(Lc ,L+i)}
		,truncate(L){fs.ftruncateSync(fd,L) ;Lc = min(Lc,L)}
		,indexOf_skipping(from,to,step,find,skip){fl‚Üê@
			if( from<0) from += fl.L ;if( to<0) to += fl.L ;from = min(max(0 ,from ),fl.L-1) ;to = min(max(-1 ,to ),fl.L)
			if( !(step===-1 && from>to)) ‚ÄΩ('TODO')
			d ‚Üê fl.read(to+1,from-to)
			for(i‚Üêfrom;i>to;i+=step) {if( d[i-(to+1)]===find) ‚Ü© i ;else if( chr(d[i-(to+1)]).match(skip)) ;else ‚Ü© ‚àÖ}
			}
		}) ;fs.closeSync(fd)}
,get json_array__synchronized(){‚Ü© Œª(‚Ä¶Œπs){_Œπ‚Üê@._Œπ
	if( Œπs.‚Äñ ) ‚ÄΩ('TODO')
	d ‚Üê JSON.parse((read_file(_Œπ)||'[]')+'')
	‚Ü© {
	,push(‚Ä¶a){a.map(Œª(Œπ){
		d.push(Œπ)
		open(_Œπ,'[]',Œª(fl){
			i ‚Üê fl.indexOf_skipping(-1,-1e4,-1,ord(']'),/[ \n\t]/) || ‚ÄΩ('bad file')
			is_0 ‚Üê fl.indexOf_skipping(i-1,-1e4,-1,ord('['),/[ \n\t]/)!==‚àÖ
			fl.write((is_0?'':',')+JSON.stringify(Œπ,‚àÖ,'  ')+']',i)
			})
		})}
	,filter(f){‚Ü© d.filter(f)}
	,get length(){‚Ü© d.‚Äñ}
	,get ['‚Äñ'](){‚Ü© d.‚Äñ}
	} }}

##################################### with #####################################
with_ ‚Üê (o,f)=> f.eval_in_lexical_env( `({${_.keys(o).join(',')}})`+(f+'').replace(/^\(\)/,'') )(o)
;(=>{ bar ‚Üê 5 ;‚Ü© with_({ baz:3 },‚Äòlexical_env=> baz+bar) })()

with_ ‚Üê (o,f)=>{
	êÖãêÖ´‚Üê'{'+_.keys(o).join(',')+'}'
	êÖ™êÖ™‚Üê_.keys(o).map(i=>`êÖ©êÖ∞.${i} = ${i}`).join(';')
	‚Ü© f.eval_in_lexical_env(`(êÖ©êÖ∞)=>{ var ${êÖãêÖ´} = êÖ©êÖ∞ ;var êÖ¶êÖ™ = (${f})() ;${êÖ™êÖ™} ;return êÖ¶êÖ™ }`)(o) }
;(=>{ bar‚Üê 2 ; t‚Üê { stone:0 } ;‚Ü© [with_(t,‚Äòlexical_env=>{ stone = 7 ;‚Ü© stone+bar }),t,bar] })()
